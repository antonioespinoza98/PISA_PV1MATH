---
title: "Influencia del género y variables socioeconómicas en el rendimiento de matemáticas en los estudiantes para prueba PISA 2012"
subtitle: "XS-2310 Modelos PRobabilísticos Discretos"
author: "Marco Antonio Espinoza Marín, B82760 | Isaura Gutiérrez Vargas, B73591 | Alison Lobo Salas, B84339 | Felipe Moya Alvarado, B85446 | Daniela Vindas Torres, B88619"
institute: "Facultad de Ciencias Económicas, Universidad de Costa Rica"
date: "Julio 19, 2021"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: libs
    nature:
      highlightStyle: arta
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(
  htmltools.dir.version  = FALSE,
  htmltools.preserve.raw = FALSE # needed for windows
)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
#librerias
library(ggplot2)
library(plotly)
library(crosstalk)
library(haven)
library(dplyr)
library(tidyr)
library(gridExtra)
library(httpuv)
library(caTools)
library(ggthemes)
library(ggthemr)
library(sjPlot)
library(ggeffects)

```

class: top, center

# Introducción

## *_¿Qué son las pruebas pisa?_*

.left[![PISA](pisa.png)]

---
class: top, center
# Objetivo
--

.left[El objetivo de este estudio radica en determinar la influencia que presentan las variables de género, migración, índice económico y educación de los padres sobre la probabilidad de estar en el segundo, tercer y cuarto nivel de alfabetización matemática en el año 2012 para los estudiantes latinoamericanos, por medio de la utilización de la regresión logística.]

---
class: top, center

# Hipótesis
--

.left[Se espera que conforme se avance en el nivel de alfabetización matemática obtenido (mientras más se acerquen los sujetos a la cola derecha de la distribución), el ser hombre, tener un índice socioeconómico y madre con niveles educativos elevados otorgue una probabilidad más alta de estar en el grupo de alto rendimiento.] 

--


.left[Por otro lado, ser migrante de primera o segunda generación disminuiría estas probabilidades]

---
class:top, center
# Revisión de literatura

![revisión](resultados.png)
---
class: top, center

# Muestra de datos

.left[El origen de la base de datos utilizada en este estudio proviene del cuestionario de
estudiantes del Programa Internacional de Evaluación de Estudiantes (PISA) durante el 2012. La
base total cuenta con 485490 observaciones de 65 países. 

Para realizar este estudio se seleccionó
las 11350 observaciones correspondientes a estudiantes latinoamericanos provenientes de
<span style="color:brown"> Colombia </span>,<span style="color:red"> Costa Rica </span>, <span style="color:blue"> Uruguay </span>, <span style="color:red">Chile</span>, <span style="color:orange">Ecuador </span>, <span style="color:red">Perú</span>,<span style="color:green"> México </span>, <span style="color:blue">Argentina</span> y <span style="color:orange"> Brasil </span>.
]

.left[
- _Género:_ variable categórica con dos niveles

- _Nivel socioeconómico:_ variable continua

- _Estatus migratorio:_ variable categórica con tres niveles

- _Nivel educativo de las madres:_ variable categórica con cinco niveles
]
---
class: top, center
# Variable dependiente

```{r , echo=FALSE, warning=FALSE, message=FALSE}

#VARIABLES INDEPENDIENTES Y DEPENDIENTES
data = read_stata("base.dta") 
#VARIABLE DEPENDIENTES
valores.log = data %>%
  dplyr::select(StIDStd,cnt,PV1MATH) %>%
  dplyr::filter(cnt == c("ARG", "BRA", "CHL","COL", "CRI", "MEX", "PER",
                         "URY"))
#REVISAMOS LA ESTRUCTURA DE NUESTRAS VARIABLES, ESTO ESPECIALMENTE PARA VER LA 
#CLASE DE CADA UNA Y VER SI NECESITAN RECODIFICACION
#QUITAMOS EL IDENTIFICADOR Y EL PAIS PARA RECODIFICAR LOS VALORES
valores.log <- valores.log[,-c(1:2)]

valores.log1 = valores.log %>% 
  mutate(PV1MATH = case_when((PV1MATH <= 420) ~ 0,
                             (PV1MATH > 420) ~ 1))
valores.log2 = valores.log %>%
  mutate(PV1MATH = case_when((PV1MATH <= 482) ~ 0,
                             (PV1MATH > 482) ~ 1))

valores.log3 = valores.log %>% 
  mutate(PV1MATH = case_when((PV1MATH <= 545) ~ 0,
                             (PV1MATH > 545) ~ 1))

ggplot(valores.log, aes(PV1MATH)) + geom_histogram(aes(y = ..density..),colour = "black", fill = "white") + xlab("PV1MATH") +
  geom_density(kernel = "gaussian", alpha=.3, fill="blue4") +  geom_vline(data=valores.log, aes(xintercept= quantile(PV1MATH,0.5992952)), linetype="dashed", size=0.8, colour="red") + geom_vline(data=valores.log, aes(xintercept = quantile(PV1MATH, 0.8326872)), linetype="dashed", size=0.8, colour="red") + geom_vline(data=valores.log, aes(xintercept = quantile(PV1MATH, 0.9530396)), linetype="dashed", size=0.8, colour="red") + theme_blank() + labs(x = "calificaciones (PV1MATH)", y = "densidad") + geom_text(aes(x=420, label="notas 1", y=0.006, angle = 0), colour="black", text=element_text(size=11)) + geom_text(aes(x=482, label="notas 2", y=0.006, angle = 0), colour="black", text=element_text(size=11)) + geom_text(aes(x=545, label="notas 3", y=0.006, angle = 0), colour="black", text=element_text(size=11))
```
---
class:top,center
#Modelo Logístico

## Forma del modelo logístico

$y^{\cdot }=\beta _o+X\beta \:+\:\iota ,\:y\:=\:1\left[y^{\cdot }>0\right]$
--

## Odd Ratio

$exp\left(\beta _i\right)=\frac{\frac{P\left(Y=1|X=2\right)}{1-P\left(Y=1|X=2\right)}}{\frac{P\left(Y=1|X=1\right)}{1-P\left(Y=1|X=1\right)}}$

--

#### .left[Modelo 1]

$P\left(notas.1|x\right)=f\left(b_0+b_1X1+b_2X2+b_3X3+b_4X4+\iota _i\right)$

--
#### .left[Modelo 2]

$P\left(notas.2|x\right)=f\left(b_0+b_1X1+b_2X2+b_3X3+b_4X4+\iota _i\right)$

--

#### .left[Modelo 3]

$P\left(notas.3|x\right)=f\left(b_0+b_1X1+b_2X2+b_3X3+b_4X4+\iota _i\right)$
---
# Paquetes utilizados para el análisis de la información recogida y versión de R utilizada

- _Librería Haven (versión: 2.4.1)_

- _Librería Tidyverse (versión: 1.3.1)_

- _Librería arm (versión: 1.11-2)_

- _Librería sjPlot (versión: 2.8.8)_

- _Librería see (0.6.4)_

- _Librería ggeffects (1.1.0)_

- _Librería Margins (0.3.26)_
---

#Tablas
![Coeficientes](coeficientes.png)
---
#Tablas
![Razón de proba](oddratio.png)
---
#Tablas

![Efectos Marginales](efectosmarginales.png)

---
class: top, center

# Brecha de genéro

```{r , echo=FALSE, warning=FALSE, message=FALSE}

#datos--------------------------------------------------------------------------

data.gender = data %>% 
  
  select(cnt,ST04Q01, PV1MATH, escs, misced, immig) %>%  filter(cnt == c("ARG","BRA","CHL","COL","CRI","MEX","PER","URY")) %>% 
  mutate(NVL1 = case_when( (PV1MATH <= 420) ~ 0, (PV1MATH > 420) ~ 1 )) %>% 
  mutate(NVL2 = case_when(  (PV1MATH <= 482)  ~ 0,
                            (PV1MATH > 482) ~1 )) %>% 
  mutate(NVL3 = case_when(  (PV1MATH <= 545) ~ 0,
                            (PV1MATH > 545) ~ 1)) %>% 
  
  mutate(Notas1 = case_when( (PV1MATH <= 420) ~ "Nota1",
                             (PV1MATH > 420) ~ "Nota1")) %>% 
  mutate(Notas2 = case_when((PV1MATH <= 482)  ~ "Nota2",(PV1MATH > 482) ~ "Nota2")) %>% 
  mutate(Notas3 = case_when(  (PV1MATH <= 545) ~ "Nota3",
                              (PV1MATH > 545) ~ "Nota3") ) %>% 
  drop_na()

colnames(data.gender)[2] = "sexo"

nvl.acadmadre = car::recode(data.gender$misced, "0 = 0; 1 = 1;
                            2:3 = 2; 4 = 3; 5 = 4; 6 = 5")
data.gender = cbind(data.gender, nvl.acadmadre)
data.gender = data.gender[, -c(1,3)]

data.gender$sexo = as.factor(data.gender$sexo)
data.gender$NVL1 = as.factor(data.gender$NVL1)
data.gender$NVL2 = as.factor(data.gender$NVL2)
data.gender$NVL3 = as.factor(data.gender$NVL3)
data.gender$Notas1 = as.factor(data.gender$Notas1)
data.gender$Notas2 = as.factor(data.gender$Notas2)
data.gender$Notas3 = as.factor(data.gender$Notas3)
data.gender$escs = as.numeric(data.gender$escs)
#plots--------------------------------------------------------------------------

#Creamos la paleta de colores
colores = RColorBrewer::brewer.pal(8, "Accent")[1:8]

#Seleccionamos los datos
data.sexo = data.gender %>% 
  gather(key = Notas, value = Decil, NVL1:NVL3)

#primer plot
plot1 = data.sexo %>% 
  filter(Notas == "NVL1") %>% 
  ggplot(aes(Decil, fill = sexo)) + geom_bar(position = "dodge",width = .5) + 
  labs(y = "Cantidad") + 
  scale_x_discrete(labels = c("Más bajo", "Más alto")) + 
  scale_fill_manual(values = colores[c(7,8)], labels = c("Mujeres","Hombres"))+ 
  theme_blank(base_size = 10)
```

```{r , echo=FALSE, message=FALSE, warning=FALSE}
plot2 = data.sexo %>% 
  filter(Notas == "NVL2") %>% 
  ggplot(aes(Decil, fill = sexo)) + geom_bar(position = "dodge",width = .5) + 
  labs(y = "Cantidad") + 
  scale_x_discrete(labels = c("Más bajo", "Más alto")) + 
  scale_fill_manual(values = colores[c(7,8)], labels = c("Mujeres","Hombres"))+ 
  theme_blank(base_size = 10)
```

```{r , echo=FALSE, warning= FALSE, message=FALSE}
plot3 = data.sexo %>% 
  filter(Notas == "NVL3") %>% 
  ggplot(aes(Decil, fill = sexo)) + geom_bar(position = "dodge",width = .5) + 
  labs(y = "Cantidad") + 
  scale_x_discrete(labels = c("Más bajo", "Más alto")) + 
  scale_fill_manual(values = colores[c(7,8)], labels = c("Mujeres","Hombres"))+ 
  theme_blank(base_size = 10)
```

```{r , echo=FALSE, message=FALSE, warning=FALSE}
sub.plots = subplot(plot1,plot2,plot3, shareY = TRUE, nrows = 3,
                    shareX = T)



layout(sub.plots,showlegend = FALSE, title = list(text = "Cantidad de estudiantes por sexo según nivel de alfabetización PISA 2012",
                               font = list(family = "Droid Sans", size = 12)), 
       coloraxis = list(xanchor = "right",
         colorbar = list(
         title = list(
           text = "Sexo",
           font = list(familiy = "Droid Sans", size = 8),
           side = "right"
         )
       )))
```
---
Class: top, center

# Nivel académico

```{r , echo=FALSE, warning=FALSE, message=FALSE}
plot_ly(data.gender, x = ~factor(nvl.acadmadre), color = ~sexo,
        colors = colores[c(7,8)], type = 'histogram') %>% 
  layout(title = list(text = 'Cantidad de estudiantes según nivel académico de la madre por sexo',font = list(family = "Droid Sans", size = 12)), xaxis = list(title = 'Nivel académico de la madre'), yaxis = list(title ='Cantidad') )

```

---
class: top, center

# Discusión

.left[![discusion](discusion.png)]





























